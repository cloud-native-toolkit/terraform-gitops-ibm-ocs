apiVersion: v1
kind: ConfigMap
metadata:
  name: ibm-odf-job-config
data:
  install-odf.sh: |
    #!/bin/bash

    ibmcloud config --check-version=false
    ibmcloud api https://cloud.ibm.com
    ibmcloud target -r $REGION
    ibmcloud login --apikey $IBMCLOUD_API_KEY

    ibmcloud plugin install kubernetes-service -f

    curl -LO https://github.com/stedolan/jq/releases/download/jq-1.6/jq-linux64 && \
    chmod a+x jq-linux64 && \
    sudo mv jq-linux64 /usr/local/bin/jq

    export OCP_VERSION="${ibmcloud ks cluster get -c $CLUSTER --output json | jq -r ".masterKubeVersion" | cut -d. -f-2}"

    ibmcloud oc cluster addon enable openshift-data-foundation -c $CLUSTER --version "${OCP_VERSION}.0"

